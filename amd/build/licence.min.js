define(["jquery","core/ajax","core/notification","core/str","core/templates","core/url"],function(a,b,c,d,e,f){return{generate:function(d){var e=a("#amount-"+d).val(),f=a("#publisherid-"+d).val();console.log({amount:e,publisherid:f}),b.call([{methodname:"block_edupublisher_licence_generate",args:{amount:e,publisherid:f},done:function(b){a("#licencekeys-"+d).val(b)},fail:c.exception}])},generateNow:function(d){var e=a("#licencekeys-"+d).val(),f=a("#publisherid-"+d).val();b.call([{methodname:"block_edupublisher_licence_generatenow",args:{licencekeys:e,publisherid:f},done:function(b){a("#licencekeys-"+d).val("")},fail:c.exception}])},generateStepSubmit:function(b,c){1==c&&a("#"+b).find(".package_choice").each(function(){a(this).prop("checked")||a(this).parent().find(".package_amount").val("")})},generateStepUi:function(b,e){1==e&&a("#"+b).find(".package_choice").each(function(){var e=a(this),f=a(this).closest(".line"),g=a("#type-"+b).val(),h=parseInt(f.find(".package_amount").val());d.get_strings([{key:"licence_amount_usages",component:"block_edupublisher",param:{amount:h}},{key:"licence_amount_infinite",component:"block_edupublisher"},{key:"licence_amount_none",component:"block_edupublisher"}]).done(function(a){2==g&&e.prop("checked")||h>0?(f.find(".package_choice").prop("checked",!0),f.find(".package_amount_lbl").html(a[0]),f.find("a.btn").addClass("active"),f.addClass("active")):2==g&&e.prop("checked")||h==-1?(f.find(".package_choice").prop("checked",!0),f.find(".package_amount_lbl").html(a[1]),f.find("a.btn").addClass("active"),f.addClass("active")):(f.find(".package_choice").prop("checked",!1),f.find(".package_amount_lbl").html(a[2]),f.find("a.btn").removeClass("active"),f.removeClass("active"))}).fail(c.exception)})},loadList:function(e){var f=a("#publisherid-"+e).val();b.call([{methodname:"block_edupublisher_licence_list",args:{publisherid:f},done:function(b){try{b=JSON.parse(b);var f=Object.keys(b),g=a("#licences-"+e).empty();if(0==f.length)d.get_strings([{key:"licences_none",component:"block_edupublisher"}]).done(function(b){a(g).append(a("<li>").html(b[0]))}).fail(c.exception);else for(var h=0;h<f.length;h++){var i=b[f[h]];a(g).append(a("<li>").append(a("<a>").attr("href","#").html(i.licencekey)))}}catch(j){console.error("Invalid response")}},fail:c.exception}])},redeem:function(d,f){"undefined"==typeof f&&(f=0);var g=this,h=a("#addlicence-"+d+' input[type="text"]').val();console.log({licencekey:h,targetid:f}),b.call([{methodname:"block_edupublisher_licence_redeem",args:{licencekey:h,targetid:f},done:function(b){console.log(b);try{b=JSON.parse(b),"undefined"!=typeof b.error?c.alert(b.heading,b.error):"undefined"!=typeof b.success?top.location.href=top.location.href:"undefined"!=typeof b.options&&(b.myuniqid=d,require(["core/modal_factory","core/modal_events"],function(c,f){c.create({type:c.types.SAVE_CANCEL,title:b.heading,body:e.render("block_edupublisher/licence_redeem_options",b)},void 0).done(function(b){console.log(b),b.show();var c=b.getRoot();c.on(f.save,function(){var b=a("#targetid-"+d).val();g.redeem(d,b)})})}))}catch(f){console.error("Invalid response",f)}},fail:c.exception}])}}});