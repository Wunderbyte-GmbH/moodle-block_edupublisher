define(["jquery","core/ajax","core/notification","core/str","core/url"],function(a,b,c,d,e){return{confirmRemoval:function(a){d.get_strings([{key:"removal:title",component:"block_edupublisher"},{key:"removal:text",component:"block_edupublisher"},{key:"yes"},{key:"no"}]).done(function(b){c.confirm(b[0],b[1],b[2],b[3],function(){top.location.href=a})}).fail(c.exception)},cancelPackageForm:function(a){d.get_strings([{key:"removal:title",component:"block_edupublisher"},{key:"removal:text",component:"block_edupublisher"},{key:"yes"},{key:"no"}]).done(function(b){c.confirm(b[0],b[1],b[2],b[3],function(){top.location.href=a})}).fail(c.exception)},exportCourseWarning:function(){var b=a("#id_exportcourse").is(":checked");b||d.get_strings([{key:"exportcourse",component:"block_edupublisher"},{key:"exportcourse_help",component:"block_edupublisher"},{key:"yes"},{key:"no"}]).done(function(b){c.confirm(b[0],b[1],b[2],b[3],function(){},function(){a("#id_exportcourse").prop("checked",!0)})}).fail(c.exception)},preparePackageForm:function(a){console.log("MAIN.preparePackageForm(channels)",a),require(["jquery"],function(b){if("undefined"!=typeof a){a=a.split(",");for(var c=0;c<a.length;c++)"default"!=a[c]&&(b('div[role="main"] #id_'+a[c]+"_publishas").is(":checked")?b('div[role="main"] input[name="id"]').val()>0&&b('div[role="main"] #id_'+a[c]+"_publishas").attr("disabled","disabled"):b('div[role="main"] #id_'+a[c]+"_publish_as").css("display","none"))}})},search:function(d,e,f){MAIN=this,console.log("MAIN.search(uniqid, courseid, sectionid)",d,e,f),MAIN.watchValue({courseid:e,sectionid:f,target:"#"+d+"-search",uniqid:d,run:function(){var d=this;console.log("Doing search via ajax for",a(d.target).val()),b.call([{methodname:"block_edupublisher_search",args:{search:a(d.target).val()},done:function(b){console.log("Result",b);var b=JSON.parse(b);console.log("Received",b),a("ul#"+d.uniqid+"-results").empty(),require(["core/templates"],function(a){for(var c=Object.keys(b.relevance),e=c.length-1;e>=0;e--)for(var f=b.relevance[c[e]],g=0;g<f.length;g++){var h=b.packages[f[g]];h.importtocourseid=d.courseid,h.importtosectionid=d.sectionid,console.log(h),a.render("block_edupublisher/search_li",h).then(function(b,c){a.appendNodeContents("ul#"+d.uniqid+"-results",b,c)}).fail(function(a){console.error(a)})}})},fail:c.exception}])}},200)},triggerActive:function(d,e,f){console.log({packageid:d,type:e,to:a(f).is(":checked")?1:0}),b.call([{methodname:"block_edupublisher_trigger_active",args:{packageid:d,type:e,to:a(f).is(":checked")?1:0},done:function(b){console.log(f,b);try{b=JSON.parse(b);for(var c=Object.keys(b),d=0;d<c.length;d++){var e=c[d].split("_"),f=e[0];1==parseInt(b[c[d]])?(a("#channel-"+f).addClass("channel-active").removeClass("channel-inactive"),a("#channel-"+f+"-active").prop("checked",!0)):(a("#channel-"+f).addClass("channel-inactive").removeClass("channel-active"),a("#channel-"+f+"-active").prop("checked",!1))}}catch(g){console.error("Invalid response")}},fail:c.exception}])},triggerRating:function(d,e,f){console.log({packageid:e,to:f}),b.call([{methodname:"block_edupublisher_rate",args:{packageid:e,to:f},done:function(b){console.log(e,b),a("#"+d+"-ratingcount").html(b.amount);for(var c=1;c<=5;c++)a("#"+d+"-rating-"+c).attr("src","/blocks/edupublisher/pix/star_"+(b.average>=c?1:0)+"_"+(b.current==c?1:0)+".png")},fail:c.exception}])},triggerConfirm:function(b,c,d){var e=this;1==c?(a(b).addClass("block-edupublisher-"+d),setTimeout(function(){e.triggerConfirm(b,0,d)},2e3)):a(b).removeClass("block-edupublisher-"+d)},watchValue:function(b,c){this.debug>5&&console.log("MAIN.watchValue(o, interval)",b,c),"undefined"==typeof c&&(c=1e3);"1"!=a(b.target).attr("data-iswatched")&&(a(b.target).attr("data-iswatched",1),b.interval=setInterval(function(){a(b.target).val()==b.compareto?(b.run(),clearInterval(b.interval),a(b.target).attr("data-iswatched",0)):b.compareto=a(b.target).val()},c))}}});